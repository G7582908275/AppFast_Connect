# AppFast Connect Windows 构建脚本使用说明

## 脚本文件

本项目提供了三个Windows构建脚本：

### 1. build-windows-release.bat (完整发行版本构建)
**功能**: 完整的发行版本构建流程，包含版本管理、打包和发布
**用法**: `build-windows-release.bat <版本号> [构建号]`
**示例**: 
- `build-windows-release.bat 1.0.0 1`
- `build-windows-release.bat 1.0.0`

**特性**:
- ✅ 版本号验证和更新
- ✅ 自动复制内核文件
- ✅ 创建完整的发布包
- ✅ 生成ZIP压缩包
- ✅ 创建版本信息和README文件
- ✅ Git提交和标签管理
- ✅ 彩色输出和错误处理

### 2. build-windows-quick.bat (快速构建)
**功能**: 快速构建用于开发和测试
**用法**: `build-windows-quick.bat`
**特性**:
- ✅ 快速构建流程
- ✅ 自动拉取代码
- ✅ 复制内核文件
- ✅ 基本的错误处理

### 3. build-windows.bat (原始脚本)
**功能**: 基础的构建脚本
**用法**: `build-windows.bat`
**特性**:
- ✅ 基本的Flutter构建
- ✅ 拉取代码和清理

## 环境要求

### 必需软件
1. **Flutter SDK** (3.8.0或更高版本)
   - 确保Flutter已添加到系统PATH
   - 运行 `flutter doctor` 检查环境

2. **Git**
   - 用于代码拉取和版本管理
   - 确保Git已添加到系统PATH

3. **Windows 10/11**
   - 支持Windows桌面应用开发
   - 建议使用64位系统

### 可选软件
- **PowerShell** (用于ZIP压缩和文件操作)
- **Visual Studio** (用于C++编译支持)

## 构建流程

### 完整发行版本构建流程
1. **环境检查**: 验证Flutter和Git环境
2. **代码同步**: 拉取最新代码
3. **内核文件**: 复制对应架构的内核文件
4. **依赖管理**: 清理旧文件并获取依赖
5. **版本更新**: 更新pubspec.yaml中的版本号
6. **应用构建**: 构建Windows发布版本
7. **打包**: 创建发布目录和ZIP压缩包
8. **文档生成**: 创建版本信息和README文件
9. **版本管理**: 可选的Git提交和标签创建

### 快速构建流程
1. **环境检查**: 验证Flutter环境
2. **代码同步**: 拉取最新代码
3. **内核文件**: 复制内核文件
4. **构建**: 清理、获取依赖并构建应用

## 输出文件

### 完整发行版本
- **发布目录**: `build\windows-release\AppFast_Connect_Windows_<版本>_<构建号>\`
- **ZIP压缩包**: `build\windows-release\AppFast_Connect_Windows_<版本>_<构建号>.zip`
- **版本信息**: `version.txt`
- **说明文档**: `README.txt`

### 快速构建
- **构建输出**: `build\windows\runner\Release\`

## 常见问题

### 1. Flutter环境问题
```
错误: 未找到Flutter
```
**解决方案**: 
- 安装Flutter SDK
- 将Flutter添加到系统PATH
- 运行 `flutter doctor` 检查环境

### 2. 内核文件缺失
```
错误: 找不到内核文件
```
**解决方案**:
- 确保 `sing-box` 目录存在
- 检查内核文件是否已下载
- 运行 `scripts\copy_kernel.bat` 手动复制

### 3. 构建失败
```
错误: Windows构建失败
```
**解决方案**:
- 检查Flutter版本兼容性
- 确保所有依赖正确安装
- 查看详细错误信息

### 4. 权限问题
```
错误: 无法创建文件或目录
```
**解决方案**:
- 以管理员身份运行脚本
- 检查目录权限
- 确保磁盘空间充足

## 最佳实践

### 版本管理
1. 使用语义化版本号 (x.y.z)
2. 构建号用于区分同一版本的多次构建
3. 重要版本建议创建Git标签

### 构建前检查
1. 确保代码已提交或暂存
2. 检查Flutter环境状态
3. 验证内核文件完整性

### 发布流程
1. 使用完整发行版本脚本构建
2. 测试构建的应用
3. 创建Git标签
4. 上传发布包到发布平台

## 脚本自定义

### 修改构建配置
- 编辑 `pubspec.yaml` 中的版本信息
- 修改 `scripts\copy_kernel.bat` 中的内核文件路径
- 调整构建参数和选项

### 添加自定义步骤
- 在脚本中添加自定义命令
- 修改输出目录结构
- 添加额外的文件复制或处理

## 技术支持

如遇到问题，请：
1. 检查环境配置
2. 查看错误日志
3. 联系开发团队
4. 提交Issue到项目仓库
